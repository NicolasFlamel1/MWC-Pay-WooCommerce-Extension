(()=>{"use strict";if(!0===MwcPayWooCommerceExtension_checkout_script_parameters.enabled){let e=!1;class t extends React.Component{render(){return React.createElement("div",{},this.props.children)}componentDidMount(){!1===e&&(e=!0,jQuery((async e=>{let t=!0===e("#radio-control-wc-payment-method-options-mwc_pay").is(":checked");if(e(document).on("change",'#payment-method input[name="radio-control-wc-payment-method-options"]',(async()=>{const o=!0===e("#radio-control-wc-payment-method-options-mwc_pay").is(":checked");if(o!==t&&(t=o,!0===t?e("span#MwcPayWooCommerceExtension_checkout_total").removeClass("MwcPayWooCommerceExtension_checkout_hide"):e("span#MwcPayWooCommerceExtension_checkout_total").addClass("MwcPayWooCommerceExtension_checkout_hide"),!0===MwcPayWooCommerceExtension_checkout_script_parameters.has_discount_or_surcharge))try{await wp.data.dispatch(wc.wcBlocksData.CART_STORE_KEY).receiveCartContents(await wp.apiFetch({path:"/wc/store/v1/cart",method:"GET",cache:"no-store"}))}catch(e){}})),wp.apiFetch.use(((o,c)=>(!0===t&&("headers"in o!=!1&&"object"==typeof o.headers&&null!==o.headers||(o.headers={}),o.headers["X-Requested-With"]="XMLHttpRequest","path"in o==!0&&"string"==typeof o.path&&!0===/^\/wc\/store\//u.test(o.path)&&(o.path+=(-1===o.path.indexOf("?")?"?":"&")+e.param({[MwcPayWooCommerceExtension_base_script_parameters.gateway_id+"_payment_method"]:MwcPayWooCommerceExtension_base_script_parameters.gateway_id}))),c(o)))),!0===t?e("span#MwcPayWooCommerceExtension_checkout_total").removeClass("MwcPayWooCommerceExtension_checkout_hide"):e("span#MwcPayWooCommerceExtension_checkout_total").addClass("MwcPayWooCommerceExtension_checkout_hide"),!0===MwcPayWooCommerceExtension_checkout_script_parameters.has_discount_or_surcharge)try{await wp.data.dispatch(wc.wcBlocksData.CART_STORE_KEY).receiveCartContents(await wp.apiFetch({path:"/wc/store/v1/cart",method:"GET",cache:"no-store"}))}catch(e){}})))}}const o="MwcPayWooCommerceExtension_checkout_price_changed_event";class c extends React.Component{constructor(e){super(e),this.PriceInCurrency_currency=wc.priceFormat.getCurrency({code:MwcPayWooCommerceExtension_base_script_parameters.currency_id,symbol:MwcPayWooCommerceExtension_base_script_parameters.currency_symbol,minorUnit:MwcPayWooCommerceExtension_base_script_parameters.currency_decimals,prefix:"",suffix:" "+MwcPayWooCommerceExtension_base_script_parameters.currency_symbol}),this.PriceInCurrency_onPriceChanged=(()=>{this.forceUpdate()}).bind(this)}render(){if(null!==MwcPayWooCommerceExtension_checkout_script_parameters.price&&null!==MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate){const e=new BigNumber(MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate);if(!1===e.isNaN()&&!0===e.isGreaterThan(0)){const t=MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate.match(/^[+-]?\d+\.(\d+)(?:e|$)/iu),o=new BigNumber(this.props.value).shiftedBy(-1*this.props.currency.minorUnit).dividedBy(e).decimalPlaces(this.props.currency.minorUnit+(null===t?0:t[1].length),BigNumber.ROUND_UP);return React.createElement("span",{id:"MwcPayWooCommerceExtension_checkout_total",className:"MwcPayWooCommerceExtension_checkout_hide"},[" ",React.createElement("bdi",{},[React.createElement("span",{dangerouslySetInnerHTML:{__html:"(≈&zwj;"}}),React.createElement(wc.blocksComponents.FormattedMonetaryAmount,{className:"MwcPayWooCommerceExtension_checkout_total_amount",currency:this.PriceInCurrency_currency,value:o.dividedBy(MwcPayWooCommerceExtension_checkout_script_parameters.price).toFixed(this.PriceInCurrency_currency.minorUnit,BigNumber.ROUND_UP).replace(".","")}),")"])])}}return null}componentDidMount(){jQuery((e=>{e(document).on(o,this.PriceInCurrency_onPriceChanged),!0===e("#radio-control-wc-payment-method-options-mwc_pay").is(":checked")?e("span#MwcPayWooCommerceExtension_checkout_total").removeClass("MwcPayWooCommerceExtension_checkout_hide"):e("span#MwcPayWooCommerceExtension_checkout_total").addClass("MwcPayWooCommerceExtension_checkout_hide")}))}componentWillUnmount(){jQuery((e=>{e(document).off(o,this.PriceInCurrency_onPriceChanged)}))}}const a=React.createElement;React.createElement=function(e,o){if("object"==typeof o&&null!==o&&"className"in o==!0&&"string"==typeof o.className){if(!0===/(?:^| )wc-block-checkout(?:$| )/u.test(o.className))return a(t,{},a(...arguments));wc.priceFormat.getCurrency().code!==MwcPayWooCommerceExtension_base_script_parameters.currency_id&&(!0===/[a-z]-totals-footer-item(?:$| )/u.test(o.className)?"value"in o==!0&&"number"==typeof o.value&&!0===Number.isFinite(o.value)&&"currency"in o==!0&&"object"==typeof o.currency&&null!==o.currency&&"minorUnit"in o.currency==!0&&"number"==typeof o.currency.minorUnit?o.value=a("span",{},[a(wc.blocksComponents.FormattedMonetaryAmount,{currency:o.currency,value:o.value}),a(c,{currency:o.currency,value:o.value})]):"value"in o==!0&&"object"==typeof o.value&&null!==o.value&&"props"in o.value==!0&&"object"==typeof o.value.props&&null!==o.value.props&&"children"in o.value.props==!0&&"object"==typeof o.value.props.children&&null!==o.value.props.children&&"props"in o.value.props.children==!0&&"object"==typeof o.value.props.children.props&&null!==o.value.props.children.props&&"className"in o.value.props.children.props==1&&!0===/(?:^| )wc-block-components-totals-footer-item-tax-value(?:$| )/u.test(o.value.props.children.props.className)&&"value"in o.value.props.children.props==!0&&"number"==typeof o.value.props.children.props.value&&!0===Number.isFinite(o.value.props.children.props.value)&&"currency"in o.value.props.children.props==!0&&"object"==typeof o.value.props.children.props.currency&&null!==o.value.props.children.props.currency&&"minorUnit"in o.value.props.children.props.currency==!0&&"number"==typeof o.value.props.children.props.currency.minorUnit&&(o.value.props.children=a("span",{},[o.value.props.children,a(c,{currency:o.value.props.children.props.currency,value:o.value.props.children.props.value})])):!0===/(?:^| )MwcPayWooCommerceExtension_checkout_total_amount(?:$| )/u.test(o.className)&&(o.fixedDecimalScale=!1))}return a(...arguments)},jQuery((e=>{class t{constructor(){this.modal=e("div#MwcPayWooCommerceExtension_checkout_modal"),this.cancelButton=this.modal.find("button"),this.updateStatusTimeout=null,this.updateInstructionsTimeout=null,this.bypassUnloadInterrupt=!1,this.updatePriceTimeout=null,this.interceptCheckoutResponses(),this.updatePrice(),this.modal.on("transitionend",(e=>{e.stopPropagation()})).on("click","> div > p > bdi:not(.MwcPayWooCommerceExtension_checkout_ignore) > span",(o=>{const c=e(o.currentTarget);!1===c.hasClass("MwcPayWooCommerceExtension_checkout_copied")&&(c.addClass("MwcPayWooCommerceExtension_checkout_copied"),setTimeout((async()=>{try{await navigator.clipboard.writeText(this.amount)}catch(e){}finally{c.removeClass("MwcPayWooCommerceExtension_checkout_copied")}}),t.WRITE_TO_CLIPBOARD_DELAY_MILLISECONDS))})).on("click","> div > p > bdi:not(.MwcPayWooCommerceExtension_checkout_ignore) > a",(t=>{const o=e(t.currentTarget),c=o.attr("href");"undefined"!=typeof MwcWallet&&!1!==t.originalEvent.isTrusted?(t.preventDefault(),MwcWallet.startTransaction(MwcWallet.MWC_WALLET_TYPE,MwcWallet.MAINNET_NETWORK_TYPE,c,this.amount).catch((e=>{t.originalEvent.target.click()}))):(o.attr("href",MwcPayWooCommerceExtension_base_script_parameters.url_protocol+c),setTimeout((()=>{o.attr("href",c)}),0))})),this.cancelButton.on("click",(async()=>{this.cancelButton.prop("disabled",!0);try{!0===(await fetch(this.cancelApi)).ok?this.hidePaymentInfo(wp.escapeHtml.escapeEditableHTML(wp.i18n.__("Order was cancelled.","mwc-pay-woocommerce-extension"))):this.cancelButton.prop("disabled",!1)}catch(e){this.cancelButton.prop("disabled",!1)}})),e(window).on("beforeunload",(e=>{if(!1===this.modal.hasClass("MwcPayWooCommerceExtension_checkout_hide")&&!1===this.bypassUnloadInterrupt)return e.preventDefault(),e.originalEvent.returnValue=!0})).on("unload",(()=>{!1===this.modal.hasClass("MwcPayWooCommerceExtension_checkout_hide")&&!1===this.bypassUnloadInterrupt?(fetch(this.cancelApi),this.hidePaymentInfo(wp.escapeHtml.escapeEditableHTML(wp.i18n.__("Order was cancelled.","mwc-pay-woocommerce-extension")))):this.hidePaymentInfo()}));let o=!0===e("#payment_method_mwc_pay").is(":checked");e("#order_review").on("change",'input[name="payment_method"]',(()=>{const t=!0===e("#payment_method_mwc_pay").is(":checked");t!==o&&(o=t,!0===o?e("span#MwcPayWooCommerceExtension_checkout_total").removeClass("MwcPayWooCommerceExtension_checkout_hide"):e("span#MwcPayWooCommerceExtension_checkout_total").addClass("MwcPayWooCommerceExtension_checkout_hide"),!0===MwcPayWooCommerceExtension_checkout_script_parameters.has_discount_or_surcharge&&e(document.body).trigger("update_checkout"))})),e(document.body).on("updated_checkout",(()=>{!0===o?e("span#MwcPayWooCommerceExtension_checkout_total").removeClass("MwcPayWooCommerceExtension_checkout_hide"):e("span#MwcPayWooCommerceExtension_checkout_total").addClass("MwcPayWooCommerceExtension_checkout_hide")})),0!==e("#payment_method_mwc_pay").length&&(!0===o?e("span#MwcPayWooCommerceExtension_checkout_total").removeClass("MwcPayWooCommerceExtension_checkout_hide"):e("span#MwcPayWooCommerceExtension_checkout_total").addClass("MwcPayWooCommerceExtension_checkout_hide")),!0===MwcPayWooCommerceExtension_checkout_script_parameters.has_discount_or_surcharge&&e(document.body).trigger("update_checkout")}interceptCheckoutResponses(){e.ajaxPrefilter(((e,o,c)=>{if("undefined"!=typeof wc_checkout_params&&"url"in e==!0&&e.url===wc_checkout_params.checkout_url&&"data"in e==!0){const o=new URLSearchParams(e.data);!0===o.has("payment_method")&&o.get("payment_method")===MwcPayWooCommerceExtension_base_script_parameters.gateway_id&&(this.successCallback=e.success,e.success=e=>{"success"!==e.result||"status_api"in e==!1?this.successCallback(e):(this.amount=e.amount,this.timeout=parseInt(e.timeout,t.DECIMAL_NUMBER_BASE),this.cancelApi=e.cancel_api,this.showPaymentInfo(e.url,e.amount,e.required_number_of_block_confirmations,e.recipient_payment_proof_address,e.price_in_currency,e.price_in_mimblewimble_coin,e.payment_method_title,e.status_api,e.redirect))})}})),wp.apiFetch.use(((o,c)=>"method"in o==!0&&"POST"===o.method&&"path"in o==!0&&"string"==typeof o.path&&!0===/^\/wc\/store\/(?:v\d+\/)?checkout(?:$|\/|\\|\?)/u.test(o.path.replace(/[\/\\]+$/u,""))&&"data"in o==!0&&"object"==typeof o.data&&null!==o.data&&"payment_method"in o.data==!0&&o.data.payment_method===MwcPayWooCommerceExtension_base_script_parameters.gateway_id?("headers"in o!=!1&&"object"==typeof o.headers&&null!==o.headers||(o.headers={}),o.headers["X-Requested-With"]="XMLHttpRequest",new Promise(((a,s)=>c(o).then((o=>o.clone().json().then((c=>{const n=c.payment_result.payment_details.reduce(((e,t)=>(e[t.key]=t.value,e)),{});"success"!==n.result||"status_api"in n==!1?a(o):(this.successCallback=t=>{"success"===t.result?a(o):s(new Response(JSON.stringify({message:e(t.messages).html()})))},this.amount=n.amount,this.timeout=parseInt(n.timeout,t.DECIMAL_NUMBER_BASE),this.cancelApi=n.cancel_api,this.showPaymentInfo(n.url,n.amount,n.required_number_of_block_confirmations,n.recipient_payment_proof_address,n.price_in_currency,n.price_in_mimblewimble_coin,n.payment_method_title,n.status_api,n.redirect))})).catch((e=>{a(o)})))).catch((e=>{s(e)}))))):c(o)))}updatePrice(c=!1){clearTimeout(this.updatePriceTimeout),this.updatePriceTimeout=setTimeout((async()=>{try{if(wc.priceFormat.getCurrency().code!==MwcPayWooCommerceExtension_base_script_parameters.currency_id&&0!==e("#payment_method_mwc_pay, #radio-control-wc-payment-method-options-mwc_pay").length&&!0===this.modal.hasClass("MwcPayWooCommerceExtension_checkout_hide")){const t=await(await fetch(MwcPayWooCommerceExtension_checkout_script_parameters.get_price_api)).json();(null!==t.price&&t.price!==MwcPayWooCommerceExtension_checkout_script_parameters.price||null!==t.currency_exchange_rate&&t.currency_exchange_rate!==MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate)&&(null!==t.price&&(MwcPayWooCommerceExtension_checkout_script_parameters.price=t.price),null!==t.currency_exchange_rate&&(MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate=t.currency_exchange_rate),e(document.body).trigger("update_checkout"),e(document).trigger(o))}}catch(e){}finally{this.updatePrice()}}),!0===c?0:t.UPDATE_PRICE_INTERVAL_MILLISECONDS)}showPaymentInfo(o,c,a,s,n,r,i,m,p){this.modal.css("z-index",e.blockUI.defaults.baseZ);const u=this.modal.find("> div:last-of-type").css("background-color",e(document.body).css("background-color")).css("background-color");!0===t.colorIsDark(u)?this.modal.addClass("MwcPayWooCommerceExtension_checkout_invert"):this.modal.removeClass("MwcPayWooCommerceExtension_checkout_invert"),this.modal.find("> div > p:first-of-type").empty(),this.modal.find("h2").text(i);try{qrcode.stringToBytes=qrcode.stringToBytesFuncs["UTF-8"];const e=qrcode(0,t.QR_CODE_ERROR_CORRECTION_LEVEL);e.addData(JSON.stringify({"Recipient Address":o,Amount:c}),"Byte"),e.make(),this.modal.find("img").replaceWith(e.createImgTag()),this.modal.find("img").attr("alt",wp.i18n.__("Payment QR code","mwc-pay-woocommerce-extension")),this.modal.addClass("MwcPayWooCommerceExtension_checkout_qrcode")}catch(e){this.modal.removeClass("MwcPayWooCommerceExtension_checkout_qrcode")}this.modal.find("p:last-of-type").html(wp.i18n.sprintf(wp.escapeHtml.escapeEditableHTML(wp.i18n.__("The transaction's recipient payment proof address for this order is %s","mwc-pay-woocommerce-extension")),"<span><bdi>"+wp.escapeHtml.escapeEditableHTML(s)+"</bdi>.</span>")),this.cancelButton.prop("disabled",!1),this.updateInstructions(o,a,n,r),this.modal.removeClass("MwcPayWooCommerceExtension_checkout_hide"),this.updateStatus(m,p)}hidePaymentInfo(e=null){this.cancelButton.prop("disabled",!0),this.modal.trigger(t.CANCELLED_EVENT),clearTimeout(this.updateStatusTimeout),clearTimeout(this.updateInstructionsTimeout),null!==e&&this.successCallback({result:"failure",messages:'<div class="woocommerce-error">'+e+"</div>",refresh:!1,reload:!1}),this.modal.addClass("MwcPayWooCommerceExtension_checkout_hide"),null!==e&&this.updatePrice(!0)}updateInstructions(e,o,c,a){const s=this.modal.find("> div > p:first-of-type");!0===s.is(":empty")||wp.i18n._n("Send %1$s%2$s to %3$s in the next %4$s second to complete your order.","Send %1$s%2$s to %3$s in the next %4$s seconds to complete your order.",this.timeout,"mwc-pay-woocommerce-extension")!==wp.i18n._n("Send %1$s%2$s to %3$s in the next %4$s second to complete your order.","Send %1$s%2$s to %3$s in the next %4$s seconds to complete your order.",this.timeout+1,"mwc-pay-woocommerce-extension")?s.html(wp.i18n.sprintf(wp.escapeHtml.escapeEditableHTML(wp.i18n._n("Send %1$s%2$s to %3$s in the next %4$s second to complete your order.","Send %1$s%2$s to %3$s in the next %4$s seconds to complete your order.",this.timeout,"mwc-pay-woocommerce-extension")),a,wc.priceFormat.getCurrency().code!==MwcPayWooCommerceExtension_base_script_parameters.currency_id?' <bdi class="MwcPayWooCommerceExtension_checkout_ignore">(≈&zwj;'+c+")</bdi>":"",'<bdi><a href="'+wp.escapeHtml.escapeQuotationMark(e)+'" aria-label="'+wp.escapeHtml.escapeQuotationMark(wp.i18n.__("Open payment URL","mwc-pay-woocommerce-extension"))+'" target="_blank" rel="nofollow noopener noreferrer">'+wp.escapeHtml.escapeEditableHTML(e)+"</a></bdi>",'<bdi class="MwcPayWooCommerceExtension_checkout_timeout">'+wp.escapeHtml.escapeEditableHTML(t.addThousandSeparator(this.timeout.toFixed()))+"</bdi>")+" "+wp.i18n.sprintf(wp.escapeHtml.escapeEditableHTML(wp.i18n._n("This order will start processing once its payment achieves %1$s block confirmation %2$s minute%3$s.","This order will start processing once its payment achieves %1$s block confirmations %2$s minutes%3$s.",parseInt(o,t.DECIMAL_NUMBER_BASE),"mwc-pay-woocommerce-extension")),"<bdi>"+wp.escapeHtml.escapeEditableHTML(t.addThousandSeparator(o))+"</bdi>","<bdi>(≈&zwj;"+wp.escapeHtml.escapeEditableHTML(t.addThousandSeparator(o))+"</bdi>","<bdi>)</bdi>")):s.find("> bdi.MwcPayWooCommerceExtension_checkout_timeout").text(t.addThousandSeparator(this.timeout.toFixed())),this.timeout>1&&(this.updateInstructionsTimeout=setTimeout((()=>{--this.timeout,this.updateInstructions(e,o,c,a)}),1*t.MILLISECONDS_IN_A_SECOND))}async updateStatus(e,o){let c=!1;this.modal.one(t.CANCELLED_EVENT,(()=>{c=!0}));let a=!0;try{const t=await(await fetch(e)).json();!1===c&&(!0===t.paid?(a=!1,this.cancelButton.prop("disabled",!0),this.bypassUnloadInterrupt=!0,this.successCallback({result:"success",redirect:o})):!0===t.expired?(a=!1,this.hidePaymentInfo(wp.escapeHtml.escapeEditableHTML(wp.i18n.__("Order expired.","mwc-pay-woocommerce-extension")))):!0===t.cancelled&&(a=!1,this.hidePaymentInfo(wp.escapeHtml.escapeEditableHTML(wp.i18n.__("Order was cancelled.","mwc-pay-woocommerce-extension")))))}catch(e){}finally{!1===c&&(this.modal.off(t.CANCELLED_EVENT),!0===a&&(this.updateStatusTimeout=setTimeout((()=>{this.updateStatus(e,o)}),Math.min(t.UPDATE_STATUS_INTERVAL_MILLISECONDS,this.timeout*t.MILLISECONDS_IN_A_SECOND))))}}static colorIsDark(e){const o=e.match(/^rgba?\((\d+), *(\d+), *(\d+)/u),c=parseInt(o[1],t.DECIMAL_NUMBER_BASE),a=parseInt(o[2],t.DECIMAL_NUMBER_BASE),s=parseInt(o[3],t.DECIMAL_NUMBER_BASE);return Math.sqrt(.299*Math.pow(c,2)+.587*Math.pow(a,2)+.114*Math.pow(s,2))<=t.UINT8_MAX/2}static addThousandSeparator(e){return e.replace(/\B(?=(\d{3})+(?!\d))/gu,wc.priceFormat.getCurrency().thousandSeparator)}static get QR_CODE_ERROR_CORRECTION_LEVEL(){return"L"}static get WRITE_TO_CLIPBOARD_DELAY_MILLISECONDS(){return 200}static get CANCELLED_EVENT(){return"MwcPayWooCommerceExtension_checkout_cancelled_event"}static get MILLISECONDS_IN_A_SECOND(){return 1e3}static get SECONDS_IN_A_MINUTE(){return 60}static get UPDATE_STATUS_INTERVAL_MILLISECONDS(){return 10*t.MILLISECONDS_IN_A_SECOND}static get UPDATE_PRICE_INTERVAL_MILLISECONDS(){return 10*t.SECONDS_IN_A_MINUTE*t.MILLISECONDS_IN_A_SECOND}static get DECIMAL_NUMBER_BASE(){return 10}static get UINT8_MAX(){return 255}}new t}))}})();