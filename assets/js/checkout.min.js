(()=>{"use strict";if(!0===MwcPayWooCommerceExtension_checkout_script_parameters.enabled){let e=!1;class t extends React.Component{render(){return React.createElement("div",{},this.props.children)}componentDidMount(){!1===e&&(e=!0,jQuery((async e=>{let t=!0===e("#radio-control-wc-payment-method-options-mwc_pay").is(":checked");if(e(document).on("change",'#payment-method input[name="radio-control-wc-payment-method-options"]',(async()=>{const c=!0===e("#radio-control-wc-payment-method-options-mwc_pay").is(":checked");if(c!==t&&(t=c,!0===MwcPayWooCommerceExtension_checkout_script_parameters.has_discount_or_surcharge))try{await wp.data.dispatch(wc.wcBlocksData.CART_STORE_KEY).receiveCartContents(await wp.apiFetch({path:"/wc/store/v1/cart",method:"GET",cache:"no-store"}))}catch(e){}})),wp.apiFetch.use(((c,o)=>(!0===t&&("headers"in c!=!1&&"object"==typeof c.headers&&null!==c.headers||(c.headers={}),c.headers["X-Requested-With"]="XMLHttpRequest","path"in c==!0&&"string"==typeof c.path&&!0===/^\/wc\/store\//u.test(c.path)&&(c.path+=(-1===c.path.indexOf("?")?"?":"&")+e.param({[MwcPayWooCommerceExtension_base_script_parameters.gateway_id+"_payment_method"]:MwcPayWooCommerceExtension_base_script_parameters.gateway_id}))),o(c)))),!0===MwcPayWooCommerceExtension_checkout_script_parameters.has_discount_or_surcharge)try{await wp.data.dispatch(wc.wcBlocksData.CART_STORE_KEY).receiveCartContents(await wp.apiFetch({path:"/wc/store/v1/cart",method:"GET",cache:"no-store"}))}catch(e){}})))}}const c="MwcPayWooCommerceExtension_checkout_price_changed_event";class o extends React.Component{#e;#t;constructor(e){super(e),this.#e=wc.priceFormat.getCurrency({code:MwcPayWooCommerceExtension_base_script_parameters.currency_id,symbol:MwcPayWooCommerceExtension_base_script_parameters.currency_symbol,minorUnit:MwcPayWooCommerceExtension_base_script_parameters.currency_decimals,prefix:"",suffix:" "+MwcPayWooCommerceExtension_base_script_parameters.currency_symbol}),this.#t=(()=>{this.forceUpdate()}).bind(this)}render(){if(null!==MwcPayWooCommerceExtension_checkout_script_parameters.price&&null!==MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate){const e=new BigNumber(MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate);if(!1===e.isNaN()&&!0===e.isGreaterThan(0)){const t=MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate.match(/^[+-]?\d+\.(\d+)(?:e|$)/iu),c=new BigNumber(this.props.value).shiftedBy(-1*this.props.currency.minorUnit).dividedBy(e).decimalPlaces(this.props.currency.minorUnit+(null===t?0:t[1].length),BigNumber.ROUND_UP);return React.createElement("span",{id:"MwcPayWooCommerceExtension_checkout_total"},[" ",React.createElement("bdi",{},[React.createElement("span",{dangerouslySetInnerHTML:{__html:"(≈&zwj;"}}),React.createElement(wc.blocksComponents.FormattedMonetaryAmount,{className:"MwcPayWooCommerceExtension_checkout_total_amount",currency:this.#e,value:c.dividedBy(MwcPayWooCommerceExtension_checkout_script_parameters.price).toFixed(this.#e.minorUnit,BigNumber.ROUND_UP).replace(".","")}),")"])])}}return null}componentDidMount(){jQuery((e=>{e(document).on(c,this.#t)}))}componentWillUnmount(){jQuery((e=>{e(document).off(c,this.#t)}))}}const a=React.createElement;React.createElement=function(e,c){if("object"==typeof c&&null!==c&&"className"in c==!0&&"string"==typeof c.className){if(!0===/(?:^| )wc-block-checkout(?:$| )/u.test(c.className))return a(t,{},a(...arguments));wc.priceFormat.getCurrency().code!==MwcPayWooCommerceExtension_base_script_parameters.currency_id&&(!0===/[a-z]-totals-footer-item(?:$| )/u.test(c.className)?"value"in c==!0&&"number"==typeof c.value&&!0===Number.isFinite(c.value)&&"currency"in c==!0&&"object"==typeof c.currency&&null!==c.currency&&"minorUnit"in c.currency==!0&&"number"==typeof c.currency.minorUnit&&(c.value=a("span",{},[a(wc.blocksComponents.FormattedMonetaryAmount,{currency:c.currency,value:c.value}),a(o,{currency:c.currency,value:c.value})])):!0===/(?:^| )MwcPayWooCommerceExtension_checkout_total_amount(?:$| )/u.test(c.className)&&(c.fixedDecimalScale=!1))}return a(...arguments)},jQuery((e=>{class t{#c;#o;#a;#r;#s;#n;#i;#m;#u;#p;constructor(){this.#c=e("div#MwcPayWooCommerceExtension_checkout_modal"),this.#o=this.#c.find("button"),this.#a=null,this.#n=null,this.#u=!1,this.#p=null,this.#_(),this.#d(),this.#c.on("transitionend",(e=>{e.stopPropagation()})).on("click","> div > p > bdi:not(.MwcPayWooCommerceExtension_checkout_ignore) > span",(c=>{const o=e(c.currentTarget);!1===o.hasClass("MwcPayWooCommerceExtension_checkout_copied")&&(o.addClass("MwcPayWooCommerceExtension_checkout_copied"),setTimeout((async()=>{try{await navigator.clipboard.writeText(this.#r)}catch(e){}finally{o.removeClass("MwcPayWooCommerceExtension_checkout_copied")}}),t.#h))})).on("click","> div > p > bdi:not(.MwcPayWooCommerceExtension_checkout_ignore) > a",(t=>{const c=e(t.currentTarget),o=c.attr("href");"undefined"!=typeof MwcWallet&&!1!==t.originalEvent.isTrusted?(t.preventDefault(),MwcWallet.startTransaction(MwcWallet.MWC_WALLET_TYPE,MwcWallet.MAINNET_NETWORK_TYPE,o,this.#r).catch((e=>{t.originalEvent.target.click()}))):(c.attr("href",MwcPayWooCommerceExtension_base_script_parameters.url_protocol+o),setTimeout((()=>{c.attr("href",o)}),0))})),this.#o.on("click",(()=>{fetch(this.#i),this.#l(wp.escapeHtml.escapeEditableHTML(wp.i18n.__("Order was cancelled.","mwc-pay-woocommerce-extension")))})),e(window).on("beforeunload",(e=>{if(!1===this.#c.hasClass("MwcPayWooCommerceExtension_checkout_hide")&&!1===this.#u)return e.preventDefault(),e.originalEvent.returnValue=!0})).on("unload",(()=>{!1===this.#c.hasClass("MwcPayWooCommerceExtension_checkout_hide")&&!1===this.#u?this.#o.trigger("click"):this.#l()}));let c=!0===e("#payment_method_mwc_pay").is(":checked");e("#order_review").on("change",'input[name="payment_method"]',(()=>{const t=!0===e("#payment_method_mwc_pay").is(":checked");t!==c&&(c=t,!0===MwcPayWooCommerceExtension_checkout_script_parameters.has_discount_or_surcharge&&e(document.body).trigger("update_checkout"))})),!0===MwcPayWooCommerceExtension_checkout_script_parameters.has_discount_or_surcharge&&e(document.body).trigger("update_checkout")}#_(){e.ajaxPrefilter(((e,c,o)=>{if("undefined"!=typeof wc_checkout_params&&"url"in e==!0&&e.url===wc_checkout_params.checkout_url&&"data"in e==!0){const c=new URLSearchParams(e.data);!0===c.has("payment_method")&&c.get("payment_method")===MwcPayWooCommerceExtension_base_script_parameters.gateway_id&&(this.#m=e.success,e.success=e=>{"success"!==e.result||"status_api"in e==!1?this.#m(e):(this.#r=e.amount,this.#s=parseInt(e.timeout,t.#y),this.#i=e.cancel_api,this.#w(e.url,e.amount,e.required_number_of_block_confirmations,e.recipient_payment_proof_address,e.price_in_currency,e.price_in_mimblewimble_coin,e.payment_method_title,e.status_api,e.redirect))})}})),wp.apiFetch.use(((c,o)=>"method"in c==!0&&"POST"===c.method&&"path"in c==!0&&"string"==typeof c.path&&!0===/^\/wc\/store\/(?:v\d+\/)?checkout(?:$|\/|\\|\?)/u.test(c.path.replace(/[\/\\]+$/u,""))&&"data"in c==!0&&"object"==typeof c.data&&null!==c.data&&"payment_method"in c.data==!0&&c.data.payment_method===MwcPayWooCommerceExtension_base_script_parameters.gateway_id?("headers"in c!=!1&&"object"==typeof c.headers&&null!==c.headers||(c.headers={}),c.headers["X-Requested-With"]="XMLHttpRequest",new Promise(((a,r)=>o(c).then((c=>c.clone().json().then((o=>{const s=o.payment_result.payment_details.reduce(((e,t)=>(e[t.key]=t.value,e)),{});"success"!==s.result||"status_api"in s==!1?a(c):(this.#m=t=>{"success"===t.result?a(c):r(Response.json({message:e(t.messages).html()}))},this.#r=s.amount,this.#s=parseInt(s.timeout,t.#y),this.#i=s.cancel_api,this.#w(s.url,s.amount,s.required_number_of_block_confirmations,s.recipient_payment_proof_address,s.price_in_currency,s.price_in_mimblewimble_coin,s.payment_method_title,s.status_api,s.redirect))})).catch((e=>{a(c)})))).catch((e=>{r(e)}))))):o(c)))}#d(o=!1){clearTimeout(this.#p),this.#p=setTimeout((async()=>{try{if(wc.priceFormat.getCurrency().code!==MwcPayWooCommerceExtension_base_script_parameters.currency_id&&0!==e("#payment_method_mwc_pay, #radio-control-wc-payment-method-options-mwc_pay").length&&!0===this.#c.hasClass("MwcPayWooCommerceExtension_checkout_hide")){const t=await(await fetch(MwcPayWooCommerceExtension_checkout_script_parameters.get_price_api)).json();(null!==t.price&&t.price!==MwcPayWooCommerceExtension_checkout_script_parameters.price||null!==t.currency_exchange_rate&&t.currency_exchange_rate!==MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate)&&(null!==t.price&&(MwcPayWooCommerceExtension_checkout_script_parameters.price=t.price),null!==t.currency_exchange_rate&&(MwcPayWooCommerceExtension_checkout_script_parameters.currency_exchange_rate=t.currency_exchange_rate),e(document.body).trigger("update_checkout"),e(document).trigger(c))}}catch(e){}finally{this.#d()}}),!0===o?0:t.#E)}#w(c,o,a,r,s,n,i,m,u){this.#c.css("z-index",e.blockUI.defaults.baseZ);const p=this.#c.find("> div:nth-of-type(2)").first().css("background-color",e(document.body).css("background-color")).css("background-color");!0===t.#C(p)?this.#c.addClass("MwcPayWooCommerceExtension_checkout_invert"):this.#c.removeClass("MwcPayWooCommerceExtension_checkout_invert"),this.#c.find("> div > p:first-of-type").empty(),this.#c.find("h2").text(i);try{qrcode.stringToBytes=qrcode.stringToBytesFuncs["UTF-8"];const e=qrcode(0,t.#M);e.addData(JSON.stringify({"Recipient Address":c,Amount:o}),"Byte"),e.make(),this.#c.find("img").removeClass("MwcPayWooCommerceExtension_checkout_hide").replaceWith(e.createImgTag())}catch(e){this.#c.find("img").addClass("MwcPayWooCommerceExtension_checkout_hide")}this.#c.find("p:nth-of-type(2)").html(wp.i18n.sprintf(wp.escapeHtml.escapeEditableHTML(wp.i18n.__("The recipient payment proof address for this order is %s","mwc-pay-woocommerce-extension")),"<span><bdi>"+wp.escapeHtml.escapeEditableHTML(r)+"</bdi>.</span>")),this.#o.prop("disabled",!1),this.#b(c,a,s,n),this.#c.removeClass("MwcPayWooCommerceExtension_checkout_hide"),this.#P(m,u)}#l(e=null){this.#o.prop("disabled",!0),this.#c.trigger(t.#f),clearTimeout(this.#a),clearTimeout(this.#n),null!==e&&this.#m({result:"failure",messages:'<div class="woocommerce-error">'+e+"</div>",refresh:!1,reload:!1}),this.#c.addClass("MwcPayWooCommerceExtension_checkout_hide"),null!==e&&this.#d(!0)}#b(e,c,o,a){const r=this.#c.find("> div > p:first-of-type");!0===r.is(":empty")||wp.i18n._n("Send %1$s%2$s to %3$s in the next %4$s second to complete your order.","Send %1$s%2$s to %3$s in the next %4$s seconds to complete your order.",this.#s,"mwc-pay-woocommerce-extension")!==wp.i18n._n("Send %1$s%2$s to %3$s in the next %4$s second to complete your order.","Send %1$s%2$s to %3$s in the next %4$s seconds to complete your order.",this.#s+1,"mwc-pay-woocommerce-extension")?r.html(wp.i18n.sprintf(wp.escapeHtml.escapeEditableHTML(wp.i18n._n("Send %1$s%2$s to %3$s in the next %4$s second to complete your order.","Send %1$s%2$s to %3$s in the next %4$s seconds to complete your order.",this.#s,"mwc-pay-woocommerce-extension")),a,wc.priceFormat.getCurrency().code!==MwcPayWooCommerceExtension_base_script_parameters.currency_id?' <bdi class="MwcPayWooCommerceExtension_checkout_ignore">(≈&zwj;'+o+")</bdi>":"",'<bdi><a href="'+wp.escapeHtml.escapeQuotationMark(e)+'" aria-label="'+wp.escapeHtml.escapeQuotationMark(wp.i18n.__("Open payment URL","mwc-pay-woocommerce-extension"))+'" target="_blank" rel="nofollow noopener noreferrer">'+wp.escapeHtml.escapeEditableHTML(e)+"</a></bdi>",'<bdi class="MwcPayWooCommerceExtension_checkout_timeout">'+wp.escapeHtml.escapeEditableHTML(t.#I(this.#s.toFixed()))+"</bdi>")+" "+wp.i18n.sprintf(wp.escapeHtml.escapeEditableHTML(wp.i18n._n("This order will start processing once its payment achieves %1$s block confirmation %2$s minute%3$s.","This order will start processing once its payment achieves %1$s block confirmations %2$s minutes%3$s.",parseInt(c,t.#y),"mwc-pay-woocommerce-extension")),"<bdi>"+wp.escapeHtml.escapeEditableHTML(t.#I(c))+"</bdi>","<bdi>(≈&zwj;"+wp.escapeHtml.escapeEditableHTML(t.#I(c))+"</bdi>","<bdi>)</bdi>")):r.find("> bdi.MwcPayWooCommerceExtension_checkout_timeout").text(t.#I(this.#s.toFixed())),this.#s>1&&(this.#n=setTimeout((()=>{--this.#s,this.#b(e,c,o,a)}),1*t.#g))}async#P(e,c){let o=!1;this.#c.one(t.#f,(()=>{o=!0}));let a=!0;try{const r=await(await fetch(e)).json();!1===o&&(!0===r.paid?(a=!1,this.#o.prop("disabled",!0),this.#u=!0,this.#m({result:"success",redirect:c})):!0===r.expired?(a=!1,this.#l(wp.escapeHtml.escapeEditableHTML(wp.i18n.__("Order expired.","mwc-pay-woocommerce-extension")))):!0===r.cancelled&&(a=!1,this.#l(wp.escapeHtml.escapeEditableHTML(wp.i18n.__("Order was cancelled.","mwc-pay-woocommerce-extension")))))}catch(e){}finally{!1===o&&(this.#c.off(t.#f),!0===a&&(this.#a=setTimeout((()=>{this.#P(e,c)}),Math.min(t.#x,this.#s*t.#g))))}}static#C(e){const c=e.match(/^rgba?\((\d+), *(\d+), *(\d+)/u),o=parseInt(c[1],t.#y),a=parseInt(c[2],t.#y),r=parseInt(c[3],t.#y);return Math.sqrt(.299*Math.pow(o,2)+.587*Math.pow(a,2)+.114*Math.pow(r,2))<=t.#T/2}static#I(e){return e.replace(/\B(?=(\d{3})+(?!\d))/gu,wc.priceFormat.getCurrency().thousandSeparator)}static get#M(){return"L"}static get#h(){return 200}static get#f(){return"MwcPayWooCommerceExtension_checkout_cancelled_event"}static get#g(){return 1e3}static get#k(){return 60}static get#x(){return 10*t.#g}static get#E(){return 10*t.#k*t.#g}static get#y(){return 10}static get#T(){return 255}}new t}))}})();